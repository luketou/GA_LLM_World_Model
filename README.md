ğŸ—‚ Molecular-Agent v1.0

ğŸŒ Workflow

1ï¸âƒ£ å•Ÿå‹•éšæ®µ (main.py)
    â€¢	è®€å– settings.yaml
    â€¢	åˆå§‹åŒ–ï¼š
        â—‹	GuacaMolOracle (åˆ†å­è©•åˆ†å¼•æ“)
        â—‹	KGStore (çŸ¥è­˜åœ–è­œå­˜å„²ï¼ŒNeo4j/MockKG)
        â—‹	LLMGenerator (Cerebras LLMï¼Œæ¨¡å‹ï¼šllama-3.3-70b)
        â—‹	MCTSEngine (è’™ç‰¹å¡ç¾…æ¨¹æœç´¢å¼•æ“)
    â€¢	Prescanï¼š
        â—‹	å° smi_file å…¨åˆ—è¡¨è©•åˆ† â†’ å–æœ€ä½åˆ† SMILES ä½œç‚º seed
        â—‹	åˆå§‹åŒ– AgentState(seed) â†’ å•Ÿå‹• graph_app

â¸»

2ï¸âƒ£ LangGraph æµç¨‹ (graph/workflow_graph.py)

| Node | åŠŸèƒ½ | LLM ä»‹å…¥ |
|------|------|----------|
| **Generate** | ğŸ§  **LLM æ™ºæ…§æ±ºç­–**ï¼šåˆ†æç•¶å‰åˆ†æ”¯æ­·å²ï¼Œå¾ Coarse/Fine Action åº«ä¸­é¸æ“‡ K å€‹æœ€ä½³å‹•ä½œ | âœ… Action é¸æ“‡ |
| **LLM** | ğŸ”¬ **åˆ†å­ç”Ÿæˆ**ï¼šLLMGenerator.generate_batch() â†’ ä¾é¸å®šå‹•ä½œç”¢ç”Ÿå­ SMILES | âœ… åˆ†å­åˆæˆ |
| **Oracle (async)** | ğŸ“Š **åˆ†å­è©•åˆ†**ï¼šGuacaMolOracle.score_async() â†’ å›å‚³é©æ‡‰åº¦åˆ†æ•¸ | âŒ |
| **Adv** | ğŸ“ˆ **å­¸ç¿’æ›´æ–°**ï¼šè¨ˆç®— baseline + advantagesï¼Œæ›´æ–° KG + MCTS çµ±è¨ˆ | âŒ |
| **Decide** | ğŸŒ³ **æ¨¹æœç´¢**ï¼šUCT é¸å­ç¯€é»ï¼›é”çµ‚æ…‹æˆ–é…é¡è€—ç›¡æ™‚çµæŸ | âŒ |

â¸»

3ï¸âƒ£ LLM å°å¼•çš„å‹•ä½œé¸æ“‡ (LLM-Guided Action Selection)
å–ä»£åŸæœ‰çš„è¦å‰‡å¼/éš¨æ©ŸæŠ½æ¨£ï¼Œæ–°çš„ `Generate` ç¯€é»æ¡ç”¨ **é›™é‡ LLM æ™ºæ…§æ±ºç­–**ï¼š

### ğŸ” æ­·å²åˆ†æèˆ‡å‹•ä½œé¸æ“‡æµç¨‹
1. **æ­·å²å›æº¯** (`kg.get_branch_history()`)
   - å¾çŸ¥è­˜åœ–è­œä¸­æå–ç•¶å‰åˆ†å­ç¯€é»å›æº¯è‡³æ ¹ç¯€é»çš„å®Œæ•´è·¯å¾‘
   - åŒ…å«ï¼šçˆ¶ä»£åˆ†å­ SMILES + åŸ·è¡Œçš„ Action + ç²å¾—çš„é©æ‡‰åº¦åˆ†æ•¸

2. **æƒ…å¢ƒåŒ–æç¤º** (`llm_gen.select_actions()`)
   ```
   You are an expert medicinal chemist...
   Path history: [Root] â†’ [Action1] â†’ [Molecule1, Score1] â†’ ...
   Current molecule: {parent_smiles} (Score: {current_score})
   Available actions: [44 Coarse + 20 Fine actions]
   Select top K most promising actions...
   ```

3. **LLM æ±ºç­–** (Cerebras llama-3.3-70b)
   - æ‰®æ¼”å°ˆå®¶åŒ–å­¸å®¶ï¼Œåˆ†ææ­·å²è¶¨å‹¢
   - å¾ 64 å€‹å€™é¸å‹•ä½œä¸­é¸å‡ºæœ€å…·æ½›åŠ›çš„ K å€‹
   - å›å‚³ JSON æ ¼å¼ï¼š`["action_name_1", "action_name_2", ...]`

4. **åˆ†å­åŸ·è¡Œ** (`llm_gen.generate_batch()`)
   - å°‡é¸å®šçš„ Action å‚³éçµ¦åˆ†å­ç”Ÿæˆæ¨¡çµ„
   - LLM æ ¹æ“šå‹•ä½œæŒ‡ä»¤åˆæˆæ–°çš„ SMILES çµæ§‹

### ğŸ”„ å®¹éŒ¯æ©Ÿåˆ¶
- **æ ¹ç¯€é»è™•ç†**ï¼šROOT ç¯€é»ç›´æ¥ä½¿ç”¨ coarse action éš¨æ©ŸæŠ½æ¨£
- **æ­·å²ä¸è¶³æ™‚**ï¼š
  - æ­·å²é•·åº¦ < 2ï¼šè‡ªå‹•é€€å›è¦å‰‡å¼æŠ½æ¨£
  - ç¬¬ä¸€å±¤ç¯€é»ï¼šä½¿ç”¨è¦å‰‡å¼æ–¹æ³•å»ºç«‹åˆå§‹æ­·å²
  - depth < 5: Coarse actions, depth â‰¥ 5: Fine actions
- **LLM å¤±æ•—æ™‚**ï¼šException handling â†’ è¦å‰‡å¼å‚™æ´
- **ç©ºçµæœè™•ç†**ï¼šç¢ºä¿å§‹çµ‚è¿”å›æœ‰æ•ˆçš„å‹•ä½œåˆ—è¡¨
- **å¾ªç’°æª¢æ¸¬**ï¼šé˜²æ­¢æ­·å²å›æº¯æ™‚å‡ºç¾ç„¡é™å¾ªç’°

â¸»

4ï¸âƒ£ è³‡æ–™å„²å­˜èˆ‡è¿½è¹¤
    â€¢	**Oracle è©•åˆ†æ—¥èªŒ**ï¼šscore_log.csv (é™é¡ 500 æ¬¡èª¿ç”¨)
    â€¢	**çŸ¥è­˜åœ–è­œ**ï¼šåˆ†å­ç¯€é»/Action é‚Š/çµ±è¨ˆæ•¸æ“š â†’ Neo4j KG (æˆ– MockKG)
    â€¢	**å·¥ä½œæµæª¢æŸ¥é»**ï¼šLangGraph checkpoint â†’ .lg_ckpt.db
    â€¢	**å…¨ç¨‹è¿½è¹¤**ï¼šLangSmith ç¯€é»ç´š tracing (project: "world model agent")

â¸»

### ğŸ§ª Action Library (ç¸½è¨ˆ 64 ç¨®å‹•ä½œ)

#### ğŸ”§ Coarse Actions (44 ç¨®)
**å–®ç’°èŠ³é¦™æ—ç³»çµ± (12ç¨®)**
- åŸºæœ¬èŠ³ç’°ï¼šè‹¯ç’°ã€å¡å•¶ã€å˜§å•¶ã€å¡å—ªã€å™ å—ª
- äº”å“¡é›œç’°ï¼šå™»å©ã€å‘‹å–ƒã€å¡å’¯ã€å’ªå”‘ã€å™»å”‘ã€å™å”‘ã€å¡å”‘

**ç¨ ç’°èŠ³é¦™æ—ç³»çµ± (10ç¨®)**
- è˜ç³»ï¼šè˜ã€å–¹å•‰ã€ç•°å–¹å•‰ã€å–¹å”‘å•‰ã€å–¹å™å•‰
- é›œç¨ ç’°ï¼šè‹¯ä¸¦å™»å©ã€è‹¯ä¸¦å‘‹å–ƒã€å²å“šã€è‹¯ä¸¦å’ªå”‘ã€å˜Œå‘¤

**é£½å’Œç’°ç³»çµ± (8ç¨®)**
- çƒ·ç’°ï¼šç’°å·±çƒ·ã€ç’°æˆŠçƒ·
- å«æ°®é£½å’Œç’°ï¼šå“Œå•¶ã€å“Œå—ªã€å—å•‰ã€å¡å’¯çƒ·
- å«æ°§é£½å’Œç’°ï¼šå››æ°«å‘‹å–ƒã€å››æ°«å¡å–ƒ

**è—¥ç‰©å¸¸è¦‹éª¨æ¶ (5ç¨®)**
- ç‰¹æ®Šçµæ§‹ï¼šè¯è‹¯ã€å˜§å•¶é…®ã€ä¸‰å—ªã€ä¸‰å”‘ã€å››å”‘

**å®˜èƒ½åŸºæ·»åŠ  (3ç¨®)**
- åŸºæœ¬åŸºåœ˜ï¼šç¾¥åŸº (-OH)ã€æ°¨åŸº (-NH2)ã€ç¾§åŸº (-COOH)

**çµæ§‹èª¿æ•´ (6ç¨®)**
- åˆ†å­ä¿®é£¾ï¼šæ¸›å°‘åˆ†å­é‡ã€é›œåŸå­äº¤æ›ã€æˆç’°åæ‡‰ã€é–‹ç’°åæ‡‰ã€éˆå»¶é•·ã€éˆç¸®çŸ­

#### ğŸ¯ Fine Actions (20 ç¨®)
**å°åˆ†å­åŸºåœ˜ (6ç¨®)**
- çƒ·åŸºï¼šç”²åŸºã€ä¹™åŸºã€ä¸™åŸºã€ç•°ä¸™åŸºã€ä¸åŸºã€å”ä¸åŸº

**å®˜èƒ½åŸº (10ç¨®)**
- å«æ°§ï¼šç¾¥åŸºã€ç¾°åŸºã€é…¯åŸºã€é†šéµã€é†¯èƒºåŸº
- å«æ°®ï¼šæ°¨åŸºã€è…ˆåŸºã€ç¡åŸº
- å«ç¡«ï¼šç£ºé†¯åŸº

**é¹µç´ å–ä»£ (4ç¨®)**
- é¹µç´ ï¼šæ°Ÿ (-F)ã€æ°¯ (-Cl)ã€æº´ (-Br)ã€ç¢˜ (-I)

â¸»

### âš™ï¸ æ ¸å¿ƒåƒæ•¸ (config/settings.yml)
```yaml
# MCTS æœç´¢åƒæ•¸
K_init: 30          # æ¯ç¯€é»ç”Ÿæˆåˆ†å­æ•¸é‡
max_depth: 50       # æœç´¢æ¨¹æœ€å¤§æ·±åº¦
c_uct: 1.4         # UCT æ¢ç´¢å¸¸æ•¸

# Oracle é™åˆ¶
oracle_limit: 500   # æœ€å¤§è©•åˆ†æ¬¡æ•¸
oracle_rate: 600_per_hour

# LLM é…ç½®
llm:
  provider: cerebras
  model_name: llama-3.3-70b
  temperature: 0.2
  max_completion_tokens: 2048

# å·¥ä½œæµç¨‹
workflow:
  max_iterations: 1000
  early_stop_threshold: 0.9
  max_smiles_length: 100
```

â¸»

### ğŸ¯ æ ¸å¿ƒå‰µæ–°é»
1. **é›™é‡ LLM æ¶æ§‹**ï¼šAction é¸æ“‡ + åˆ†å­ç”Ÿæˆï¼Œå…©éšæ®µæ™ºæ…§æ±ºç­–
2. **æ­·å²æ„ŸçŸ¥æ¢ç´¢**ï¼šå¾éå¾€æˆåŠŸ/å¤±æ•—è·¯å¾‘ä¸­å­¸ç¿’æœ€ä½³ç­–ç•¥
3. **å‹•æ…‹å‹•ä½œåº«**ï¼š64 ç¨®ç²¾å¿ƒè¨­è¨ˆçš„åŒ–å­¸è½‰æ›ï¼Œæ¶µè“‹ç²—ç²’åº¦åˆ°å¾®èª¿
4. **å®¹éŒ¯å‚™æ´æ©Ÿåˆ¶**ï¼šLLM å¤±æ•—æ™‚è‡ªå‹•åˆ‡æ›è‡³è¦å‰‡å¼æ–¹æ³•
5. **å…¨ç¨‹å¯è¿½è¹¤**ï¼šLangSmith + Neo4j + Checkpoint å¤šå±¤æ¬¡è¨˜éŒ„




